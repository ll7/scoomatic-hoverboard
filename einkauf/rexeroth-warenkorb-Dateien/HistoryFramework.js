function TrackingStack(){this.TrackingStackContainer=new Array();this.PushEntry=PushEntry;this.PopEntry=PopEntry;this.GetEntry=GetEntry;this.PopEntryByIndex=PopEntryByIndex;this.GetEntryByIndex=GetEntryByIndex;this.PopEntryByIndex=PopEntryByIndex;this.GetEntryIndexByValue=GetEntryIndexByValue;this.emptyStack=emptyStack;this.sliceStack=sliceStack;this.size=size}function PushEntry(a){this.TrackingStackContainer.push(a)}function PopEntry(){return this.TrackingStackContainer.pop()}function GetEntry(){return this.TrackingStackContainer[this.TrackingStackContainer.length-1]}function PopEntryByIndex(a){return this.TrackingStackContainer.splice(a,1)[0]}function GetEntryByIndex(a){return this.TrackingStackContainer[a]}function GetEntryIndexByValue(b){var a=0;while(a<this.TrackingStackContainer.length){if(this.TrackingStackContainer[a].getUrl()==b.getUrl()&&this.TrackingStackContainer[a].postBody==b.postBody){return a}++a}return -1}function GetHistoryObjectFromOpener(b){var a=0;while(a<b.length){if(b[a].windowName==window.name){return a}++a}return -1}function sliceStack(b,a){this.TrackingStackContainer.splice(b,a-b)}function emptyStack(a){return this.TrackingStackContainer[a]}function size(){return this.TrackingStackContainer.length}function HistoryFramework(){this.lastEntry=null;this.lastVisitedTitleParam="";this.lastVisitedPathInexesParam="";this.TrackingEntries=new TrackingStack;this.LastVisitedEntries=new TrackingStack;this.NoDuplicationArray=new Array();this.ActiveTrackingEntryIndex=-1;this.saveLastVisitedTitle=saveLastVisitedTitle;this.getLastVisitedTitle=getLastVisitedTitle;this.saveLastVisitedPathIndexes=saveLastVisitedPathIndexes;this.getLastVisitedPathIndexes=getLastVisitedPathIndexes;this.RetrieveNewActiveValue=RetrieveNewActiveValue;this.DecreaseIndex=DecreaseIndex;this.AddTrackingEntry=AddTrackingEntry;this.AddTrackingEntryAllowDuplicate=AddTrackingEntryAllowDuplicate;this.SetActiveTrackingEntryIndex=SetActiveTrackingEntryIndex;this.UpdateStack=UpdateStack;this.CurrentNodeIsDummy=CurrentNodeIsDummy;this.ArrayContains=ArrayContains;this.GetBackObject=GetBackObject;this.GetForwardObject=GetForwardObject;this.GetTrackingListPreActive=GetTrackingListPreActive;this.GetTrackingListPostActive=GetTrackingListPostActive;this.GetActiveTrackingEntryIndex=GetActiveTrackingEntryIndex;this.GetActiveTrackingEntryValue=GetActiveTrackingEntryValue;this.GetLastEntry=GetLastEntry;this.TrackingEntryBack=TrackingEntryBack;this.TrackingEntryForward=TrackingEntryForward;this.GetLastVisitedList=GetLastVisitedList;this.CutLastVisitedListByIndex=CutLastVisitedListByIndex;this.AddToLastVisitedList=AddToLastVisitedList;this.GetEntryIndexByValue=FrameworkGetEntryIndexByValue;this.GetEntryValueByIndex=GetEntryValueByIndex;this.Navigate=NavigateToHistory;this.checkHistoryLength=checkHistoryLength;this.windowName=window.name}function DecreaseIndex(){var a=this.GetActiveTrackingEntryIndex();if((a!=0)||(dummy==true)){if(this.CurrentNodeIsDummy()==false){this.SetActiveTrackingEntryIndex(a-1)}else{this.SetActiveTrackingEntryIndex(a)}}if(this.GetActiveTrackingEntryIndex()==0&&NovaHyperlink){NovaHyperlink.disableHyperlink("buttonBack_HyperLink")}}function RetrieveNewActiveValue(){var a=this.GetActiveTrackingEntryIndex();if((a!=0)||(dummy==true)){var c=null;if(this.CurrentNodeIsDummy()==false){c=this.TrackingEntries.TrackingStackContainer[this.GetActiveTrackingEntryIndex()-1]}else{c=this.TrackingEntries.TrackingStackContainer[this.GetActiveTrackingEntryIndex()]}var b=new HistoryEntry(c.URL,c.title,c.params,c.context,c.postBody,c.pathIndexes,c.URL,c.navMode);this.AddToLastVisitedList(b);saveObjectInOpener(this);return c}else{return null}}function saveLastVisitedPathIndexes(a){this.lastVisitedPathInexesParam=a}function getLastVisitedPathIndexes(){return gHistoryFrameworkObj.lastVisitedPathInexesParam.split(",")}function saveLastVisitedTitle(a){this.lastVisitedTitleParam=a}function getLastVisitedTitle(){return gHistoryFrameworkObj.lastVisitedTitleParam}function parsePostParams(b,k){var n=null;if(k!=null){if(b==null||typeof b!="undefined"){n=new Array()}else{n=b}var j=EPCM.DSM.getTerminationData(false);var m=EPCM.getSAPTop().termDataBackup;var e=EPCM.DSM.mergeTerminationData(m,j);var d=k.split(";");var f=0;for(f=0;f<d.length;f++){var a=d[f].indexOf("=");if(a>=0){var g=d[f].substring(0,a);var c=d[f].substr(a+1);var l=false;for(var h in e){if(g==h){l=true;break}}if(g=="NavPathUpdate"||g=="buildTree"){l=true}if(l==false){n.push({name:g,value:c})}}}}if(n.length>0){return n}else{return null}}function AddTrackingEntry(m,e,a,d,b,g,j,c,l){dummy=false;if(c!=null&&c==true){EPCM.getSAPTop().postBody=j}else{if(j!=null){EPCM.getSAPTop().postBody=parsePostParams(EPCM.getSAPTop().postBody,j)}}this.saveLastVisitedTitle(e);this.saveLastVisitedPathIndexes(b);var f=a;if(a.length!=0&&a.charAt(0)!="&"){f="&"+f}if(m!=null&&m!=""){if(this.TrackingEntries.size()==0||(m+f)!=this.TrackingEntries.GetEntryByIndex(this.TrackingEntries.size()-1).getUrl()||d!=this.TrackingEntries.GetEntryByIndex(this.TrackingEntries.size()-1).context){var i=new HistoryEntry(m,e,a,d,getPostBody(),b,g,l);var h=this.TrackingEntries.GetEntryIndexByValue(i);if(h==-1){if(this.TrackingEntries.size()>this.GetActiveTrackingEntryIndex()+1){this.TrackingEntries.sliceStack(this.GetActiveTrackingEntryIndex()+1,this.TrackingEntries.size())}this.checkHistoryLength();this.TrackingEntries.PushEntry(i);this.SetActiveTrackingEntryIndex(this.TrackingEntries.size()-1)}else{this.SetActiveTrackingEntryIndex(h)}}else{this.SetActiveTrackingEntryIndex(this.TrackingEntries.size()-1)}var k=new HistoryEntry(m,e,a,d,getPostBody(),b,g,l);gHistoryFrameworkObj.lastEntry=k;gHistoryFrameworkObj.saveLastVisitedTitle(k.title);this.AddToLastVisitedList(k)}}var array=new Array();var dummy=false;function onSaveDummy(a){array.push(gHistoryFrameworkObj.GetActiveTrackingEntryIndex());gHistoryFrameworkObj.saveLastVisitedTitle(a.dataObject.title);gHistoryFrameworkObj.saveLastVisitedPathIndexes(a.dataObject.pathIndexes);onSaveLastEntry(a);dummy=true}function onSaveLastEntry(a){var b=new HistoryEntry(a.dataObject.URL,a.dataObject.title,a.dataObject.params,a.dataObject.context,getPostBody(),a.dataObject.pathIndexes,a.dataObject.fullURL,a.dataObject.navMode);gHistoryFrameworkObj.saveLastVisitedTitle(a.dataObject.title);gHistoryFrameworkObj.saveLastVisitedPathIndexes(a.dataObject.pathIndexes);gHistoryFrameworkObj.lastEntry=b;saveObjectInOpener(gHistoryFrameworkObj)}var isFirstTimeOpened=true;function getPostBody(){var a=EPCM.getSAPTop().postBody;if(isFirstTimeOpened){if(a==null&&typeof(opener)!="undefined"&&opener!=null){try{var c=opener.EPCM;if(typeof(c)!="undefined"&&c!=null){a=c.getSAPTop().postBody}}catch(b){}}isFirstTimeOpened=false}return a}function AddTrackingEntryAllowDuplicate(l,e,a,d,b,g,i,c,k){dummy=false;if(c!=null&&c==true){EPCM.getSAPTop().postBody=i}else{if(i!=null){EPCM.getSAPTop().postBody=parsePostParams(EPCM.getSAPTop().postBody,i)}}var f=a;if(a.length!=0&&a.charAt(0)!="&"){f="&"+f}if(l!=null&&l!=""){this.saveLastVisitedTitle(e);this.saveLastVisitedPathIndexes(b);if(this.TrackingEntries.size()==0||(l+f)!=this.TrackingEntries.GetEntryByIndex(this.TrackingEntries.size()-1).getUrl()){var h=new HistoryEntry(l,e,a,d,getPostBody(),b,g,k);if(this.TrackingEntries.size()>this.GetActiveTrackingEntryIndex()+1){this.TrackingEntries.sliceStack(this.GetActiveTrackingEntryIndex()+1,this.TrackingEntries.size())}this.checkHistoryLength();this.TrackingEntries.PushEntry(h);this.SetActiveTrackingEntryIndex(this.TrackingEntries.size()-1)}else{this.SetActiveTrackingEntryIndex(this.TrackingEntries.size()-1)}var j=new HistoryEntry(l,e,a,d,getPostBody(),b,g,k);gHistoryFrameworkObj.lastEntry=j;gHistoryFrameworkObj.saveLastVisitedTitle(j.title);this.AddToLastVisitedList(j)}}function UpdateStack(a){var b=array.length-1;deleteIndex=null;while(b>=0){if(a<=array[b]){deleteIndex=b;lowestBeforeDummyIndex=array[b]}b--}if(deleteIndex!=null){array.splice(deleteIndex,array.length);this.TrackingEntries.TrackingStackContainer.splice(lowestBeforeDummyIndex+1,this.TrackingEntries.TrackingStackContainer.length)}}function SetActiveTrackingEntryIndex(a){this.UpdateStack(a);if(a>=0&&a<this.TrackingEntries.size()){this.ActiveTrackingEntryIndex=a}}function GetForwardObject(){var a=this.TrackingEntries.TrackingStackContainer[this.ActiveTrackingEntryIndex+1];if(a!=null){return a}}function GetBackObject(){if(dummy==true){temparray=this.TrackingEntries.TrackingStackContainer}else{temparray=this.TrackingEntries.TrackingStackContainer.slice(0,this.ActiveTrackingEntryIndex)}return temparray[temparray.length-1]}function GetTrackingListPreActive(){return this.TrackingEntries.TrackingStackContainer.slice(0,this.ActiveTrackingEntryIndex)}function GetTrackingListPostActive(){return this.TrackingEntries.TrackingStackContainer.slice(this.ActiveTrackingEntryIndex+1)}function GetActiveTrackingEntryIndex(){return this.ActiveTrackingEntryIndex}function GetActiveTrackingEntryValue(){return this.TrackingEntries.TrackingStackContainer[this.GetActiveTrackingEntryIndex()]}function GetLastEntry(){return this.lastEntry}function CurrentNodeIsDummy(){if(this.ArrayContains(array,this.ActiveTrackingEntryIndex)){return true}return false}function ArrayContains(a,c){var b=0;while(b<a.length){if(a[b]==c){return true}b++}return false}function TrackingEntryBack(){var a=this.GetActiveTrackingEntryIndex();if((a!=0)||(dummy==true)){if(this.CurrentNodeIsDummy()==false){this.SetActiveTrackingEntryIndex(a-1)}else{this.SetActiveTrackingEntryIndex(a)}var c=this.GetActiveTrackingEntryValue();dummy=false;var b=new HistoryEntry(c.URL,c.title,c.params,c.context,c.postBody,c.pathIndexes,c.URL,c.navMode);this.AddToLastVisitedList(b);saveObjectInOpener(this);return c}else{return null}}function saveObjectInOpener(d){var b=frameworkSupport.innerPageFrameURL;var a=b?b.indexOf("com.sap.portal.embedded_headerless_frameworkpage")>0:false;if(window.opener!=null&&typeof window.opener=="object"&&window.opener.closed!=true&&a==true){if(typeof window.opener.historyArray!="object"||typeof window.opener.historyArray.length!="number"){window.opener.historyArray=new Array()}var c=GetHistoryObjectFromOpener(window.opener.historyArray);if(c>-1){window.opener.historyArray[c]=d}else{window.opener.historyArray[window.opener.historyArray.length]=d}}}function TrackingEntryForward(){var a=this.GetActiveTrackingEntryIndex();if(a<this.TrackingEntries.size()-1){++this.ActiveTrackingEntryIndex;var c=this.GetActiveTrackingEntryValue();var b=new HistoryEntry(c.URL,c.title,c.params,c.context,c.postBody,c.pathIndexes,c.URL,c.navMode);this.AddToLastVisitedList(b);saveObjectInOpener(this);dummy=false;return c}else{return null}}function GetLastVisitedList(){return this.LastVisitedEntries.TrackingStackContainer}function CutLastVisitedListByIndex(b){if(b>=0&&b<this.LastVisitedEntries.size()){var a=this.LastVisitedEntries.TrackingStackContainer.slice(0,b+1);this.LastVisitedEntries.TrackingStackContainer=a}}function AddToLastVisitedList(a){if(this.LastVisitedEntries.size()>0){if(this.LastVisitedEntries.GetEntry().getUrl()==a.getUrl()){return}}this.LastVisitedEntries.PushEntry(a)}function FrameworkGetEntryIndexByValue(a){return this.TrackingEntries.GetEntryIndexByValue(a)}function GetEntryValueByIndex(c){var d=null;var b=this.GetActiveTrackingEntryIndex();if(c==0){d=this.GetActiveTrackingEntryValue()}else{if(c>0){var a=this.GetTrackingListPostActive();if(c>a.length){return null}d=a[c-1]}else{c=-c;var a=this.GetTrackingListPreActive();if(c>a.length){return null}d=a[a.length-c]}}return d}function NavigateToHistory(ind,isBreadcrumb){var obj=null;var currentIndex=this.GetActiveTrackingEntryIndex();if(isBreadcrumb){obj=this.LastVisitedEntries.GetEntry()}else{obj=this.GetEntryValueByIndex(ind)}if(obj!=null){this.SetActiveTrackingEntryIndex(eval(currentIndex+ind));this.AddToLastVisitedList(obj);return obj.navigate()}}function checkHistoryLength(){if(this.TrackingEntries.size()>12){this.TrackingEntries.PopEntryByIndex(0)}if(this.LastVisitedEntries.size()>12){this.LastVisitedEntries.PopEntryByIndex(0)}}var gHistoryFrameworkObj;function init(){gHistoryFrameworkObj=new HistoryFramework();EPCM.subscribeEvent("urn:com.sapportals:navigation","SaveLastVisitedTitle",onSaveLastVisitedTitle);EPCM.subscribeEvent("urn:com.sapportals:navigation","SaveLastEntry",onSaveLastEntry);EPCM.subscribeEvent("urn:com.sapportals:navigation","AddNavTarget",onNewNavigationTarget);EPCM.subscribeEvent("urn:com.sapportals:navigation","SaveDummy",onSaveDummy);EPCM.subscribeEvent("urn:com.sapportals:navigation","AddNavTargetAllowDuplicate",onNewNavigationTargetAllowDuplicate);EPCM.subscribeEvent("urn:com.sapportals:navigation","setNavTargetPanel",onNavPanelChanged);EPCM.subscribeEvent("urn:com.sapportals:navigation","historyNavigate",onHistoryNavigate);try{if(window.opener!=null&&typeof window.opener!="undefined"&&typeof window.opener.historyArray=="object"&&window.opener.closed!=true){var a=GetHistoryObjectFromOpener(window.opener.historyArray);if(a>-1){var b=0;for(b=0;b<window.opener.historyArray[a].TrackingEntries.TrackingStackContainer.length;b++){gHistoryFrameworkObj.AddTrackingEntryAllowDuplicate(window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].URL,window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].title,window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].params,window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].context,window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].pathIndexes,window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].fullURL,window.opener.historyArray[a].TrackingEntries.TrackingStackContainer[b].postBody,true)}gHistoryFrameworkObj.SetActiveTrackingEntryIndex(window.opener.historyArray[a].ActiveTrackingEntryIndex)}}}catch(c){window.opener=null}}function onSaveLastVisitedTitle(a){gHistoryFrameworkObj.saveLastVisitedTitle(a.dataObject.title)}function onNewNavigationTarget(b){if(typeof(b.dataObject)=="string"){var c=new Object();var a=b.dataObject.split("%%");c.URL=a[0];c.title=a[1];c.params=a[2];c.context=a[3];c.pathIndexes=a[4];c.fullURL=a[5];c.postParams=a[6];c.navMode=a[7]}else{var c=b.dataObject}gHistoryFrameworkObj.AddTrackingEntry(c.URL,c.title,c.params,c.context,c.pathIndexes,c.fullURL,c.postParams,false,c.navMode);saveObjectInOpener(gHistoryFrameworkObj)}function onNewNavigationTargetAllowDuplicate(b){if(typeof(b.dataObject)=="string"){var c=new Object();var a=b.dataObject.split("%%");c.URL=a[0];c.title=a[1];c.params=a[2];c.context=a[3];c.pathIndexes=a[4];c.fullURL=a[5];c.postParams=a[6];c.navMode=a[7]}else{var c=b.dataObject}gHistoryFrameworkObj.AddTrackingEntryAllowDuplicate(c.URL,c.title,c.params,c.context,c.pathIndexes,c.fullURL,c.postParams,false,c.navMode);saveObjectInOpener(gHistoryFrameworkObj)}function onNavPanelChanged(a){var b=gHistoryFrameworkObj.GetActiveTrackingEntryValue();if(b){b.setNavPanelMode(a.dataObject)}}function onHistoryNavigate(a){gHistoryFrameworkObj.Navigate(a.dataObject)}init();function HistoryEntry(a,h,g,d,f,c,b,e){this.URL=a.replace(/&/g,"%26");this.fullURL=b;this.title=h;this.params=g;this.context=null;this.postBody=null;this.pathIndexes=c;this.navMode=e;if(d){this.context=d.replace(/&/g,"%26")}if(f){this.postBody=f}this.getUrl=function(){var i=this.URL;if(this.params!=null&&this.params!=""){if(this.params.charAt(0)=="&"){i+="?"+this.params.substr(1)}else{if(this.params.charAt(0)=="?"){i+=this.params}else{i+="?"+this.params}}}return i};this.navigate=function(i){gHistoryFrameworkObj.lastEntry=this;gHistoryFrameworkObj.lastVisitedPathInexesParam=this.pathIndexes;gHistoryFrameworkObj.saveLastVisitedTitle(this.title);var k=EPCM.getSAPTop().isPerson;if(typeof(k)=="undefined"){k="3"}var j=this.getUrl()+"&ExecuteLocally=true";if(i!=null&&i==true){return EPCM.doNavigate(j,this.navMode,"","",k,"",this.context,this.postBody)}else{return EPCM.doNavigate(j,0,"","",k,"",this.context,this.postBody)}};this.noDuplicateEntry=gHistoryFrameworkObj.NoDuplicationArray[this.getUrl()];if(!this.noDuplicateEntry){this.noDuplicateEntry=new NoDuplicateEntry();gHistoryFrameworkObj.NoDuplicationArray[this.getUrl()]=this.noDuplicateEntry}else{}this.setNavPanelMode=function(i){this.noDuplicateEntry.navPanelMode=i};this.getNavPanelMode=function(){return this.noDuplicateEntry.navPanelMode};this.getPathIndexes=function(){return this.pathIndexes.split(",")};this.getFullURL=function(){return this.fullURL};this.getNavMode=function(){return this.navMode}}function NoDuplicateEntry(){this.navPanelMode=null};