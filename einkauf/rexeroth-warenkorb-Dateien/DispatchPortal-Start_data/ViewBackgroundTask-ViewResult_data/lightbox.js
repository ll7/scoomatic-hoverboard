Object.extend(String.prototype,{ensureEndsWith:function(a){return this.endsWith(a)?this:this+a},px:function(){return this.ensureEndsWith("px")}}),Object.extend(Number.prototype,{px:function(){return this.toString().px()}});var Window={size:function(){var a=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,c=window.pageXOffset||window.document.documentElement.scrollLeft||window.document.body.scrollLeft,d=window.pageYOffset||window.document.documentElement.scrollTop||window.document.body.scrollTop;return{width:a,height:b,x:c,y:d}}},FancyZoomBox={directory:"img",zooming:!1,setup:!1,init:function(a){if(!FancyZoomBox.setup){FancyZoomBox.setup=!0;var b=navigator.userAgent.match(/MSIE\s(\d)+/);if(b){var c=parseInt(b[1]);Prototype.Browser["IE"+c.toString()]=!0,Prototype.Browser.ltIE7=c<7}var d='<div id="zoom" style="display:none;"> \t\t\t\t  <div id="zoomcontainer"> \t\t\t\t\t  <div id="zoom_table" style="border-collapse:collapse;"> \t\t\t\t\t\t  <div id="zoom_content"> \t\t\t\t\t\t  </div> \t\t\t\t\t  </div> \t\t\t\t\t  <a href="#" id="zoom_close"> \t\t\t\t\t\t<span>X</span> \t\t\t\t\t  </a> \t\t\t\t  </div>                 </div>     \t\t\t<div id="zoom_layer" style="display:none;"></div>',e=$$("body").first();e.insert(d),FancyZoomBox.zoom=$("zoom"),FancyZoomBox.zoom_layer=$("zoom_layer"),FancyZoomBox.zoom_table=$("zoom_table"),FancyZoomBox.zoom_close=$("zoom_close"),FancyZoomBox.zoom_content=$("zoom_content"),FancyZoomBox.zoom_close.observe("click",FancyZoomBox.hide),$(document).observe("keyup",function(a){var b=FancyZoomBox.zoom.getStyle("display");a.keyCode==Event.KEY_ESC&&"block"==b&&FancyZoomBox.hide(a)})}},show:function(a){if(a.stop(),!FancyZoomBox.zooming){FancyZoomBox.zooming=!0;var b=a.findElement("a"),c=b.hasAttribute("zoom-layer"),d=b.hasAttribute("fixed-position"),e=b.hasAttribute("icon-position"),f=b.hasAttribute("focus-input"),g=b.content_div,h=(b.zoom_width||g.getWidth())+60;h>700&&(h=700);var i=(b.zoom_height||g.getHeight())+60,j=Window.size(),k=document.viewport.getScrollOffsets()[1],l=Math.max(j.height/2-i/2+k,0),m=j.width/2-h/2;1==d?m=275:1==e&&(m=b.cumulativeOffset()[0]+20+40),FancyZoomBox.curTop=a.pointerY(),FancyZoomBox.curLeft=a.pointerX(),FancyZoomBox.moveX=-(FancyZoomBox.curLeft-m),FancyZoomBox.moveY=-(FancyZoomBox.curTop-l),FancyZoomBox.zoom.hide().setStyle({position:"absolute",top:FancyZoomBox.curTop.px(),left:FancyZoomBox.curLeft.px()}),new Effect.Parallel([new Effect.Appear(FancyZoomBox.zoom,{sync:!0}),new Effect.Move(FancyZoomBox.zoom,{x:FancyZoomBox.moveX,y:FancyZoomBox.moveY,sync:!0}),new Effect.Morph(FancyZoomBox.zoom,{style:{width:h.px(),height:i.px()},sync:!0,beforeStart:function(a){},afterFinish:function(a){FancyZoomBox.zoom_content.innerHTML=g.innerHTML,FancyZoomBox.zoom_close.show(),FancyZoomBox.zoom.setStyle({height:"inherit",width:"inherit"}),1==c&&FancyZoomBox.zoom_layer.show(),1==f&&(firstField=$("zoom_content").down("input[focus-input=true]"),firstField&&firstField.focus()),FancyZoomBox.zooming=!1}})],{duration:.5})}},hide:function(a){a.stop(),FancyZoomBox.zooming||(FancyZoomBox.zooming=!0,FancyZoomBox.zoom.setStyle({width:"700".px(),height:"300".px()}),new Effect.Parallel([new Effect.Move(FancyZoomBox.zoom,{x:FancyZoomBox.moveX*-1,y:FancyZoomBox.moveY*-1,sync:!0}),new Effect.Morph(FancyZoomBox.zoom,{style:{width:"1".px(),height:"1".px()},sync:!0,beforeStart:function(a){FancyZoomBox.zoom_content.innerHTML="",FancyZoomBox.zoom_close.hide(),FancyZoomBox.zoom_layer.hide()},afterFinish:function(a){FancyZoomBox.zooming=!1}}),new Effect.Fade(FancyZoomBox.zoom,{sync:!0})],{duration:.5}))}},FancyZoom=Class.create({initialize:function(a){this.options=arguments.length>1?arguments[1]:{},FancyZoomBox.init(),this.element=$(a),this.element&&(this.element.content_div=$(this.element.readAttribute("href").gsub(/^#/,"")),this.element.content_div.hide(),this.element.zoom_width=this.options.width,this.element.zoom_height=this.options.height,this.element.observe("click",FancyZoomBox.show))}});